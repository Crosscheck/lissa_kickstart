<?php
/**
 * @file
 * The module that sends notifications to twitter
 */

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_form_ENTITY_TYPE_alter().
 *
 * Adds a checkbox allowing or disallowing to send a tweet for this notification
 * @param $form
 * @param FormStateInterface $form_state
 */
function notification_twitter_form_notification_entity_form_alter(&$form, FormStateInterface $form_state) {

  $path = \Drupal::routeMatch()->getRouteObject()->getPath();
  $node = \Drupal::request()->attributes->get('node');

  if (strpos($path, '/node/{node}/timeline') === 0 && $node) {
    $form['tweet'] = array(
      '#title' => 'Tweet this notification',
      '#type' => 'checkbox',
      '#default_value' => '1',
    );

    $form['actions']['submit']['#ajax'] = [
      'path' => '/notification/tweet'
    ];
  }
}
